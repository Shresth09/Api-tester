Sure, let's implement the changes step-by-step:

1. **Create a variable for the default URL:**

   Let's define a default URL that the plugin will use if no URL has been set by the user.

2. **Always show the current URL on our page:**

   We will display the current URL on the page, and if no URL is provided, we will show the default URL.

3. **Change the "Save" button to an "Edit" button:**

   We'll ensure the page initially displays the current URL (or default URL) and provide an "Edit" button to allow users to change the URL.

Here are the changes:

1. **Update the Velocity Template (`issuecrud-page.vm`):**

```velocity
<!-- templates/issuecrud-page.vm -->
<html>
<head>
    <title>Set API URL</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Set API URL</h1>

    <!-- Display current URL -->
    <p><strong>Current URL:</strong> <span id="current-url">Loading...</span></p>

    <!-- Hidden form to edit the URL -->
    <form id="edit-url-form" style="display: none;">
        <label for="api-url">API URL:</label>
        <input type="text" id="api-url" name="api-url" required>
        <button type="submit">Save URL</button>
    </form>
    
    <!-- Edit button -->
    <button id="edit-button">Edit</button>

    <div id="message"></div>

    <script type="text/javascript">
        AJS.$(document).ready(function() {
            const defaultUrl = "http://default-api-url.com"; // Default URL
            
            // Load the current URL or default URL if not set
            jQuery.ajax({
                url: AJS.params.baseURL + "/plugins/servlet/issuecrud?action=getUrl",
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    const apiUrl = response.apiUrl || defaultUrl;
                    AJS.$("#current-url").text(apiUrl);
                    AJS.$("#api-url").val(apiUrl); // Set the input field value
                }
            });

            // Show the form to edit the URL
            AJS.$("#edit-button").click(function() {
                AJS.$("#edit-url-form").show();
                AJS.$(this).hide();
            });

            // Handle form submission
            AJS.$("#edit-url-form").submit(function(e) {
                e.preventDefault();
                const apiUrl = AJS.$("#api-url").val();

                jQuery.ajax({
                    url: AJS.params.baseURL + "/plugins/servlet/issuecrud",
                    type: "POST",
                    data: { action: "saveUrl", url: apiUrl },
                    success: function(response) {
                        AJS.$("#message").html("<p style='color: green;'>URL saved successfully!</p>");
                        AJS.$("#current-url").text(apiUrl); // Update the displayed URL
                        AJS.$("#edit-url-form").hide();
                        AJS.$("#edit-button").show();
                    },
                    error: function(xhr, status, error) {
                        AJS.$("#message").html("<p style='color: red;'>Failed to save URL: " + error + "</p>");
                    }
                });
            });
        });
    </script>
</body>
</html>
```

2. **Modify the Servlet to Handle the Default URL:**

```java
package com.example.plugins.tutorial.servlet;

import com.atlassian.sal.api.pluginsettings.PluginSettings;
import com.atlassian.sal.api.pluginsettings.PluginSettingsFactory;
import com.atlassian.templaterenderer.TemplateRenderer;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class IssueCRUD extends HttpServlet {

    private static final Logger log = LoggerFactory.getLogger(IssueCRUD.class);
    private final TemplateRenderer templateRenderer;
    private final PluginSettingsFactory pluginSettingsFactory;
    private static final String PLUGIN_STORAGE_KEY = "com.example.plugins.tutorial.servlet.IssueCRUD";
    private static final String DEFAULT_API_URL = "http://default-api-url.com"; // Default URL

    public IssueCRUD(TemplateRenderer templateRenderer, PluginSettingsFactory pluginSettingsFactory) {
        this.templateRenderer = templateRenderer;
        this.pluginSettingsFactory = pluginSettingsFactory;
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String action = req.getParameter("action");
        if ("getUrl".equals(action)) {
            PluginSettings pluginSettings = pluginSettingsFactory.createGlobalSettings();
            String apiUrl = (String) pluginSettings.get(PLUGIN_STORAGE_KEY + ".apiUrl");
            if (apiUrl == null) {
                apiUrl = DEFAULT_API_URL; // Use default URL if not set
            }
            resp.setContentType("application/json");
            resp.getWriter().write("{\"apiUrl\": \"" + apiUrl + "\"}");
        } else {
            resp.setContentType("text/html;charset=utf-8");
            templateRenderer.render("templates/issuecrud-page.vm", resp.getWriter());
        }
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String action = req.getParameter("action");
        if ("saveUrl".equals(action)) {
            String apiUrl = req.getParameter("url");
            PluginSettings pluginSettings = pluginSettingsFactory.createGlobalSettings();
            pluginSettings.put(PLUGIN_STORAGE_KEY + ".apiUrl", apiUrl);
            resp.getWriter().write("URL saved successfully!");
        }
    }
}
```

3. **Update the Plugin Descriptor (`atlassian-plugin.xml`):**

Ensure your plugin descriptor correctly injects both the `TemplateRenderer` and `PluginSettingsFactory`:

```xml
<servlet name="Issue CRUD" key="issue-crud" class="com.example.plugins.tutorial.servlet.IssueCRUD">
    <description>The Issue CRUD Plugin</description>
    <url-pattern>/plugins/servlet/issuecrud</url-pattern>
    <param name="templateRenderer" value="templateRenderer"/>
    <param name="pluginSettingsFactory" value="pluginSettingsFactory"/>
</servlet>

<component-import key="templateRenderer" interface="com.atlassian.templaterenderer.TemplateRenderer"/>
<component-import key="pluginSettingsFactory" interface="com.atlassian.sal.api.pluginsettings.PluginSettingsFactory"/>
```

With these changes:
1. The plugin will use a default URL if no URL is set by the user.
2. The current URL will always be displayed on the page, defaulting to the default URL if no URL is set.
3. Users can edit the URL, and the form will display the current URL in the input field when the edit button is clicked.

Let me know if this works for you or if you need further adjustments![43dcd9a7-70db-4a1f-b0ae-981daa162054](https://github.com/narniness/code/tree/3140ff84812e7d71be214013df4b3a944ca19ea1/PagerDutyIntegration%2Fsrc%2Fmain%2Fjava%2Fcom%2Fdt%2Fjira%2Fpagerduty%2Fintgt%2Fplugin%2Fservlet%2FPagerDutyServiceServlet.java?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "1")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://github.com/Polygor/web-store/tree/cc685d5cb05022fa23d81adbadecdd2623b5a3b0/src%2Fmain%2Fjava%2Fcom%2Fepam%2Fpolygor%2Fwebstore%2Fservlet%2FErrorHandler.java?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "2")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://github.com/masudio/masudio.com/tree/5efa964b920bc18639d835a4ade5e07ae352925f/src%2Fmain%2Fjava%2Fmasudio%2Fapp%2Ffirst%2FHelloServlet.java?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "3")





<!-- templates/issuecrud-page.vm -->
<html>
<head>
    <title>Set API URL</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Set API URL</h1>

    <!-- Display current URL -->
    <p><strong>Current URL:</strong> <span id="current-url">Loading...</span></p>

    <!-- Hidden form to edit the URL -->
    <form id="edit-url-form" style="display: none;">
        <label for="api-url">API URL:</label>
        <input type="text" id="api-url" name="api-url" required>
        <button type="submit">Save URL</button>
    </form>
    
    <!-- Edit button -->
    <button id="edit-button">Edit</button>

    <div id="message"></div>

    <script type="module">
        AJS.toInit(function() {
            jQuery(document).ready(function() {
                initStuff();
            });
        });

        document.addEventListener("DOMContentLoaded", function() {
            initStuff();
            JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED, function() {
                initStuff();
            });
        });

        function initStuff() {
            const defaultUrl = "http://default-api-url.com"; // Default URL
            
            // Load the current URL or default URL if not set
            jQuery.ajax({
                url: AJS.params.baseURL + "/plugins/servlet/issuecrud?action=getUrl",
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    const apiUrl = response.apiUrl || defaultUrl;
                    AJS.$("#current-url").text(apiUrl);
                    AJS.$("#api-url").val(apiUrl); // Set the input field value
                },
                error: function() {
                    AJS.$("#current-url").text(defaultUrl);
                    AJS.$("#api-url").val(defaultUrl);
                }
            });

            // Show the form to edit the URL
            AJS.$("#edit-button").click(function() {
                AJS.$("#edit-url-form").show();
                AJS.$(this).hide();
            });

            // Handle form submission
            AJS.$("#edit-url-form").submit(function(e) {
                e.preventDefault();
                const apiUrl = AJS.$("#api-url").val();

                jQuery.ajax({
                    url: AJS.params.baseURL + "/plugins/servlet/issuecrud",
                    type: "POST",
                    data: { action: "saveUrl", url: apiUrl },
                    success: function() {
                        AJS.$("#message").html("<p style='color: green;'>URL saved successfully!</p>");
                        AJS.$("#current-url").text(apiUrl); // Update the displayed URL
                        AJS.$("#edit-url-form").hide();
                        AJS.$("#edit-button").show();
                    },
                    error: function(xhr, status, error) {
                        AJS.$("#message").html("<p style='color: red;'>Failed to save URL: " + error + "</p>");
                    }
                });
            });
        }
    </script>
</body>
</html>