AJS.$("#download-button").on("click", function() {
    var downloadvar = AJS.$("#api-response").html();

    // Create a new window for the PDF
    var printWindow = window.open('', '_blank');
    printWindow.document.open();
    printWindow.document.write('<html><head><title>User Story Report</title></head><body>' + downloadvar + '</body></html>');
    printWindow.document.close();

    // Trigger the print dialog (which can be saved as PDF)
    printWindow.focus();
    printWindow.print();
    printWindow.close();
});







<div id="api-modal" class="aui-dialog2 aui-dialog2-medium" role="dialog" aria-hidden="true" style="display: none;">

    <header class="aui-dialog2-header">
        <h2 class="aui-dialog2-header-main"> <small> CITI - PLUGIN </small><br>User Story Scanner</h2>
        <a class="aui-dialog2-header-close">
            <span class="aui-icon aui-icon-small aui-iconfont-close-dialog">Close</span>
        </a>
    </header>

    <div class="aui-dialog2-content">
        <div id="api-response">Loading data...</div>
    </div>

    <footer class="aui-dialog2-footer">
        <div class="aui-dialog2-footer-actions">
            <button id="download-button" class="aui-button">
                <span class="aui-icon aui-icon-small aui-iconfont-download"></span> Download
            </button>
            <button id="close-button" class="aui-button aui-button-primary">Close</button>
        </div>
    </footer>

</div>











<div style="margin-top: 10px; border-top: 1px solid lightgrey; border-bottom: 1px solid lightgrey; padding: 10px 0;">
    <details class="collapsible-section">
        <summary style="color: #B23802; font-weight: bold; cursor: pointer; list-style: none; display: flex; align-items: center; justify-content: space-between;">
            <span style="margin-right: 5px;">Current Story Description -</span>
            <span class="arrow">▶</span> 
        </summary>
        <div style="margin-top: 5px;">
            ${globalDescription}
        </div>
    </details>
</div>

<style>
    .collapsible-section[open] .arrow {
        transform: rotate(90deg); /* Rotate the arrow when the section is open */
    }
    .arrow {
        transition: transform 0.3s ease; /* Smooth transition for rotation */
    }
</style>
AJS.$("#accept-suggested-story").on("click", function() {
            // Your logic for handling the Accept button click
            alert("Description updated successfully");
            // Add your api call here to update Description
            AJS.dialog2("#api-modal").hide(); // Close the modal
        });

    







<div style="margin-top: 20px;">
    <details class="collapsible-section">
        <summary style="color: #000; font-weight: bold; cursor: pointer; list-style: none; display: flex; align-items: center; justify-content: space-between;">
            <div>
                <b>Rules Broken - 8 out of 14</b>
                <span style="font-size: 0.8em; color: #888;">(Generated by RecSure)</span>
            </div>
            <span class="arrow">▶</span>
        </summary>
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
            <thead>
                <tr>
                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Rule</th>
                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Status</th>
                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Link</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">Well-formed</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">Pass</td>
                    <td style="border: 1px solid #ddd; padding: 8px;"><a href="#">Well-formed</a></td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">PII Data</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">Pass</td>
                    <td style="border: 1px solid #ddd; padding: 8px;"><a href="#">PII Data</a></td>
                </tr>
            </tbody>
        </table>
    </details>
</div>

<style>
    .collapsible-section[open] .arrow {
        transform: rotate(90deg);
    }
    .arrow {
        transition: transform 0.3s ease;
    }
</style>



@(₹(₹)#?##?#




var suggestedStoryDescriptionDiv = `
    <div style="margin-top: 20px;">
        <span style="color: #B23802; font-weight: bold;">Suggested Story Description -</span>
    </div>

    <div style="margin-top: 5px;">
        <textarea id="suggested-story-textarea" class="textarea long-field" style="width: 100%; height: 100px;">
            As a developer, I want to create an Angular application with a user interface and deploy it to LSE so that users can access the application's features.
        </textarea>
    </div>

    <div style="margin-top: 10px; text-align: left;">
        <button class="aui-button" id="accept-suggested-story">
            <span class="aui-icon aui-icon-small aui-iconfont-approve"></span> Accept
        </button>
    </div>
`;



<script>
    document.getElementById('accept-suggested-story').addEventListener('click', function() {
        alert('Description updated successfully');
    });
</script>
-=-) - 




var currentStoryDescriptionDiv = `
    <div style="margin-top: 10px;">
        <span style="color: #B23802; font-weight: bold;">Current Story Description -</span>
    </div>
    <div style="margin-top: 5px;">
        The user story has some issues related to being well-formed, atomic, minimal, problem-oriented, unambiguous, a full sentence, estimable, and ADA compliant.<br><br>
        It needs to be rewritten with a clearer focus on the user's perspective, broken down into smaller stories, and avoid implementation details.
    </div>
`;



var formattedData = `
    <u><b>Overall Score: ${cscore}%</b></u><br>

    <div style='font-color:#B23802;'>
        Current Story Description -
    </div>

    ${globalDescription}<br>

    <div>
        <h3>Suggested Story Description</h3>
        <textarea id="suggested-story-description" class="textarea">${apiResponse.NA.suggestedStory}</textarea>
    </div>

    <table id="rules-table" class="aui">
        <thead>
            <tr>
                <th>Rule</th>
                <th>Status</th>
                <th>Link</th>
            </tr>
        </thead>
        <tbody>
    `;

apiResponse.NA.rules.forEach(function(rule) {
    formattedData += `
            <tr>
                <td>${rule.name}</td>
                <td>${rule.status === "passed" ? "&#9989;" : "&#9940;"} ${rule.status}</td>
                <td><a href="${rule.link}">Link</a></td>
            </tr>
    `;
});

formattedData += `
        </tbody>
    </table>

    <p><a href="link" target="_blank">Link to ROM</a></p>

    <footer class="aui-dialog2-footer">
        <div class="aui-dialog2-footer-actions">
            <button id="yes-button" class="aui-button aui-button-primary">Yes</button>
            <button id="no-button" class="aui-button">No</button>
        </div>
        <div class="aui-dialog2-footer-hint">
            3 Stars
        </div>
    </footer>
`;

AJS.$("#api-response").html(formattedData);

AJS.dialog2("#api-modal").show();
